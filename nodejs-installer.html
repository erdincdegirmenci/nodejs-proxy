<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Node.js Kurulum Yöneticisi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
    <div class="installation-container">
        <img src="https://nodejs.org/static/images/logo.svg" alt="Node.js Logo" class="logo">
        <span class="material-icons status-icon status-checking" id="statusIcon">hourglass_empty</span>
        <h1 class="status-title" id="statusTitle">Node.js Durumu Kontrol Ediliyor</h1>
        <p class="status-message" id="statusMessage">Sistem üzerinde Node.js kurulumu kontrol ediliyor...</p>
        
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-bar-fill"></div>
            </div>
        </div>

        <button class="action-button" id="actionButton" style="display: none;">
            <span class="material-icons">download</span>
            Node.js Kur
        </button>

        <p class="version-info" id="versionInfo"></p>
    </div>

    <script>
        const statusIcon = document.getElementById('statusIcon');
        const statusTitle = document.getElementById('statusTitle');
        const statusMessage = document.getElementById('statusMessage');
        const actionButton = document.getElementById('actionButton');
        const progressContainer = document.getElementById('progressContainer');
        const versionInfo = document.getElementById('versionInfo');

        // Sayfa yüklendiğinde önce Express sunucusunu başlat
        window.addEventListener('load', () => {
            startExpressServer();
        });

        function startExpressServer() {
            showInstalled();

            fetch('http://localhost:3000/api/start-express', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotInstalled();
                    } else {
                        throw new Error('Express server failed to start');
                    }
                })
                .catch(error => {
                    console.error('Express server start error:', error);
                    // 3 saniye sonra tekrar dene
                    setTimeout(() => {
                        startExpressServer();
                    }, 3000);
                });
        }

        function showNotInstalled() {
            updateStatusUI('error', 'status-not-installed',
                'Node.js Kurulu Değil',
                'Sisteminizde Node.js kurulu değil veya güncel değil. Kurulum yapmak için aşağıdaki butonu kullanın.');
            actionButton.style.display = 'inline-flex';
            actionButton.innerHTML = '<span class="material-icons">download</span> Node.js Kur';
            actionButton.onclick = startInstallation;
        }

        function showInstalled() {
            updateStatusUI('check_circle', 'status-installed',
                'Node.js Kurulu',
                'Node.js başarıyla kuruldu ve çalışıyor.');
            actionButton.style.display = 'none';
        }

        function updateStatusUI(icon, iconClass, title, message) {
            statusIcon.textContent = icon;
            statusIcon.className = `material-icons status-icon ${iconClass}`;
            statusTitle.textContent = title;
            statusMessage.textContent = message;
        }

        function startInstallation() {
            actionButton.disabled = true;
            progressContainer.style.display = 'block';
            updateStatusUI('downloading', 'status-checking',
                'Node.js Kuruluyor',
                'Node.js indiriliyor ve kuruluyor. Bu işlem birkaç dakika sürebilir...');

            fetch('http://localhost:3000/api/nodejs/install', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                            showInstalled();
                            showToast('Node.js başarıyla kuruldu!', 3000);
                        }, 2000);
                    } else {
                        throw new Error('Installation failed');
                    }
                })
                .catch(() => {
                    progressContainer.style.display = 'none';
                    actionButton.disabled = false;
                    showNotInstalled();
                    showToast('Node.js kurulumu başarısız oldu. Lütfen tekrar deneyin.', 3000);
                });
        }

        function showToast(message, duration = 2000) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), duration);
        }
    </script>
</body>
</html> 